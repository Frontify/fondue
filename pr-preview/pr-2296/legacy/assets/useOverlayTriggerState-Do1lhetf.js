import{$ as E}from"./FocusScope-BbG7qqtO.js";import{f as D,a as O}from"./useFocusRing-CqhiwHAH.js";import{a as g}from"./useEffectEvent-23OTMzEQ.js";import{r as b}from"./index-ClcD9ViR.js";import{$ as P}from"./useControlledState-CbyHarIm.js";function w(o){let{ref:t,onInteractOutside:n,isDisabled:p,onInteractOutsideStart:l}=o,m=b.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),u=g(r=>{n&&$(r,t)&&(l&&l(r),m.current.isPointerDown=!0)}),i=g(r=>{n&&n(r)});b.useEffect(()=>{let r=m.current;if(p)return;const v=t.current,s=D(v);if(typeof PointerEvent<"u"){let f=c=>{r.isPointerDown&&$(c,t)&&i(c),r.isPointerDown=!1};return s.addEventListener("pointerdown",u,!0),s.addEventListener("pointerup",f,!0),()=>{s.removeEventListener("pointerdown",u,!0),s.removeEventListener("pointerup",f,!0)}}else{let f=d=>{r.ignoreEmulatedMouseEvents?r.ignoreEmulatedMouseEvents=!1:r.isPointerDown&&$(d,t)&&i(d),r.isPointerDown=!1},c=d=>{r.ignoreEmulatedMouseEvents=!0,r.isPointerDown&&$(d,t)&&i(d),r.isPointerDown=!1};return s.addEventListener("mousedown",u,!0),s.addEventListener("mouseup",f,!0),s.addEventListener("touchstart",u,!0),s.addEventListener("touchend",c,!0),()=>{s.removeEventListener("mousedown",u,!0),s.removeEventListener("mouseup",f,!0),s.removeEventListener("touchstart",u,!0),s.removeEventListener("touchend",c,!0)}}},[t,p,u,i])}function $(o,t){if(o.button>0)return!1;if(o.target){const n=o.target.ownerDocument;if(!n||!n.documentElement.contains(o.target)||o.target.closest("[data-react-aria-top-layer]"))return!1}return t.current?!o.composedPath().includes(t.current):!1}const a=[];function I(o,t){let{onClose:n,shouldCloseOnBlur:p,isOpen:l,isDismissable:m=!1,isKeyboardDismissDisabled:u=!1,shouldCloseOnInteractOutside:i}=o;b.useEffect(()=>{if(l&&!a.includes(t))return a.push(t),()=>{let e=a.indexOf(t);e>=0&&a.splice(e,1)}},[l,t]);let r=()=>{a[a.length-1]===t&&n&&n()},v=e=>{(!i||i(e.target))&&a[a.length-1]===t&&(e.stopPropagation(),e.preventDefault())},s=e=>{(!i||i(e.target))&&(a[a.length-1]===t&&(e.stopPropagation(),e.preventDefault()),r())},f=e=>{e.key==="Escape"&&!u&&!e.nativeEvent.isComposing&&(e.stopPropagation(),e.preventDefault(),r())};w({ref:t,onInteractOutside:m&&l?s:void 0,onInteractOutsideStart:v});let{focusWithinProps:c}=O({isDisabled:!p,onBlurWithin:e=>{!e.relatedTarget||E(e.relatedTarget)||(!i||i(e.relatedTarget))&&(n==null||n())}}),d=e=>{e.target===e.currentTarget&&e.preventDefault()};return{overlayProps:{onKeyDown:f,...c},underlayProps:{onPointerDown:d}}}function M(o){let[t,n]=P(o.isOpen,o.defaultOpen||!1,o.onOpenChange);const p=b.useCallback(()=>{n(!0)},[n]),l=b.useCallback(()=>{n(!1)},[n]),m=b.useCallback(()=>{n(!t)},[n,t]);return{isOpen:t,setOpen:n,open:p,close:l,toggle:m}}export{M as $,I as a};
