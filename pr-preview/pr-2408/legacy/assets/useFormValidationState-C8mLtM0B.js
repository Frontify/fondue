import{e as b}from"./useFocusable-BVaAWhEn.js";import{r as s}from"./iframe-BTc0KMXu.js";import{f as B}from"./useFocusRing-Eh4zIRvV.js";import{$ as T}from"./useLayoutEffect-Bhzdz1pW.js";function H(t,e,i){let l=b(()=>{i&&i(e)});s.useEffect(()=>{var n;let r=t==null||(n=t.current)===null||n===void 0?void 0:n.form;return r==null||r.addEventListener("reset",l),()=>{r==null||r.removeEventListener("reset",l)}},[t])}function J(t,e,i){let{validationBehavior:l,focus:n}=t;T(()=>{if(l==="native"&&(i!=null&&i.current)&&!i.current.disabled){let o=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";i.current.setCustomValidity(o),i.current.hasAttribute("title")||(i.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(j(i.current))}});let r=s.useRef(!1),u=b(()=>{r.current||e.resetValidation()}),v=b(o=>{var a;e.displayValidation.isInvalid||e.commitValidation();let c=i==null||(a=i.current)===null||a===void 0?void 0:a.form;if(!o.defaultPrevented&&i&&c&&F(c)===i.current){var m;n?n():(m=i.current)===null||m===void 0||m.focus(),B("keyboard")}o.preventDefault()}),f=b(()=>{e.commitValidation()});s.useEffect(()=>{let o=i==null?void 0:i.current;if(!o)return;let a=o.form,c=a==null?void 0:a.reset;return a&&(a.reset=()=>{r.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,c==null||c.call(a),r.current=!1}),o.addEventListener("invalid",v),o.addEventListener("change",f),a==null||a.addEventListener("reset",u),()=>{o.removeEventListener("invalid",v),o.removeEventListener("change",f),a==null||a.removeEventListener("reset",u),a&&(a.reset=c)}},[i,l])}function U(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function j(t){return{isInvalid:!t.validity.valid,validationDetails:U(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function F(t){for(let e=0;e<t.elements.length;e++){let i=t.elements[e];if(!i.validity.valid)return i}return null}const S={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...S,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:S,validationErrors:[]},P=s.createContext({}),L="__formValidationState"+Date.now();function K(t){if(t[L]){let{realtimeValidation:e,displayValidation:i,updateValidation:l,resetValidation:n,commitValidation:r}=t[L];return{realtimeValidation:e,displayValidation:i,updateValidation:l,resetValidation:n,commitValidation:r}}return Q(t)}function Q(t){let{isInvalid:e,validationState:i,name:l,value:n,builtinValidation:r,validate:u,validationBehavior:v="aria"}=t;i&&(e||(e=i==="invalid"));let f=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,o=s.useMemo(()=>{if(!u||n==null)return null;let d=_(u,n);return D(d)},[u,n]);r!=null&&r.validationDetails.valid&&(r=void 0);let a=s.useContext(P),c=s.useMemo(()=>l?Array.isArray(l)?l.flatMap(d=>M(a[d])):M(a[l]):[],[a,l]),[m,A]=s.useState(a),[x,p]=s.useState(!1);a!==m&&(A(a),p(!1));let E=s.useMemo(()=>D(x?[]:c),[x,c]),w=s.useRef($),[g,y]=s.useState($),V=s.useRef($),R=()=>{if(!O)return;h(!1);let d=o||r||w.current;I(d,V.current)||(V.current=d,y(d))},[O,h]=s.useState(!1);return s.useEffect(R),{realtimeValidation:f||E||o||r||$,displayValidation:v==="native"?f||E||g:f||E||o||r||g,updateValidation(d){v==="aria"&&!I(g,d)?y(d):w.current=d},resetValidation(){let d=$;I(d,V.current)||(V.current=d,y(d)),v==="native"&&h(!1),p(!0)},commitValidation(){v==="native"&&h(!0),p(!0)}}}function M(t){return t?Array.isArray(t)?t:[t]:[]}function _(t,e){if(typeof t=="function"){let i=t(e);if(i&&typeof i!="boolean")return M(i)}return[]}function D(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:C}:null}function I(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((i,l)=>i===e.validationErrors[l])&&Object.entries(t.validationDetails).every(([i,l])=>e.validationDetails[i]===l)}function W(...t){let e=new Set,i=!1,l={...S};for(let u of t){var n,r;for(let v of u.validationErrors)e.add(v);i||(i=u.isInvalid);for(let v in l)(n=l)[r=v]||(n[r]=u.validationDetails[v])}return l.valid=!i,{isInvalid:i,validationErrors:[...e],validationDetails:l}}export{H as $,J as a,K as b,L as c,$ as d,W as e};
