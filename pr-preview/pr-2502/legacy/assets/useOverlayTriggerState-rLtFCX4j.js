import{b as D}from"./FocusScope-1bsShcHu.js";import{k as v,d as P}from"./useFocusRing-CUPlW5s2.js";import{a as g}from"./useEffectEvent-BWMeWV83.js";import{r as u}from"./iframe-D2yG1z8G.js";import{$ as E}from"./useControlledState-CQCIWO7H.js";function h(r){let{ref:t,onInteractOutside:n,isDisabled:l,onInteractOutsideStart:i}=r,f=u.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),d=g(o=>{n&&m(o,t)&&(i&&i(o),f.current.isPointerDown=!0)}),a=g(o=>{n&&n(o)});u.useEffect(()=>{let o=f.current;if(l)return;const $=t.current,c=v($);if(typeof PointerEvent<"u"){let p=b=>{o.isPointerDown&&m(b,t)&&a(b),o.isPointerDown=!1};return c.addEventListener("pointerdown",d,!0),c.addEventListener("click",p,!0),()=>{c.removeEventListener("pointerdown",d,!0),c.removeEventListener("click",p,!0)}}},[t,l,d,a])}function m(r,t){if(r.button>0)return!1;if(r.target){const n=r.target.ownerDocument;if(!n||!n.documentElement.contains(r.target)||r.target.closest("[data-react-aria-top-layer]"))return!1}return t.current?!r.composedPath().includes(t.current):!1}const s=[];function k(r,t){let{onClose:n,shouldCloseOnBlur:l,isOpen:i,isDismissable:f=!1,isKeyboardDismissDisabled:d=!1,shouldCloseOnInteractOutside:a}=r;u.useEffect(()=>{if(i&&!s.includes(t))return s.push(t),()=>{let e=s.indexOf(t);e>=0&&s.splice(e,1)}},[i,t]);let o=()=>{s[s.length-1]===t&&n&&n()},$=e=>{(!a||a(e.target))&&s[s.length-1]===t&&(e.stopPropagation(),e.preventDefault())},c=e=>{(!a||a(e.target))&&(s[s.length-1]===t&&(e.stopPropagation(),e.preventDefault()),o())},p=e=>{e.key==="Escape"&&!d&&!e.nativeEvent.isComposing&&(e.stopPropagation(),e.preventDefault(),o())};h({ref:t,onInteractOutside:f&&i?c:void 0,onInteractOutsideStart:$});let{focusWithinProps:b}=P({isDisabled:!l,onBlurWithin:e=>{!e.relatedTarget||D(e.relatedTarget)||(!a||a(e.relatedTarget))&&(n==null||n())}}),O=e=>{e.target===e.currentTarget&&e.preventDefault()};return{overlayProps:{onKeyDown:p,...b},underlayProps:{onPointerDown:O}}}function K(r){let[t,n]=E(r.isOpen,r.defaultOpen||!1,r.onOpenChange);const l=u.useCallback(()=>{n(!0)},[n]),i=u.useCallback(()=>{n(!1)},[n]),f=u.useCallback(()=>{n(!t)},[n,t]);return{isOpen:t,setOpen:n,open:l,close:i,toggle:f}}export{K as $,k as a};
