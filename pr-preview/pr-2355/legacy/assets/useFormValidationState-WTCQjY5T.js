import{$ as V,a as B}from"./useEffectEvent-sx_rQw4H.js";import{r as s}from"./index-ClcD9ViR.js";import{b as T}from"./useFocusRing-DlZ7W1lC.js";function G(a,e,t){let i=s.useRef(e),n=V(()=>{t&&t(i.current)});s.useEffect(()=>{var r;let l=a==null||(r=a.current)===null||r===void 0?void 0:r.form;return l==null||l.addEventListener("reset",n),()=>{l==null||l.removeEventListener("reset",n)}},[a,n])}function H(a,e,t){let{validationBehavior:i,focus:n}=a;B(()=>{if(i==="native"&&(t!=null&&t.current)&&!t.current.disabled){let o=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";t.current.setCustomValidity(o),t.current.hasAttribute("title")||(t.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(j(t.current))}});let r=V(()=>{e.resetValidation()}),l=V(o=>{var v;e.displayValidation.isInvalid||e.commitValidation();let c=t==null||(v=t.current)===null||v===void 0?void 0:v.form;if(!o.defaultPrevented&&t&&c&&F(c)===t.current){var f;n?n():(f=t.current)===null||f===void 0||f.focus(),T("keyboard")}o.preventDefault()}),u=V(()=>{e.commitValidation()});s.useEffect(()=>{let o=t==null?void 0:t.current;if(!o)return;let v=o.form;return o.addEventListener("invalid",l),o.addEventListener("change",u),v==null||v.addEventListener("reset",r),()=>{o.removeEventListener("invalid",l),o.removeEventListener("change",u),v==null||v.removeEventListener("reset",r)}},[t,l,u,r,i])}function U(a){let e=a.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function j(a){return{isInvalid:!a.validity.valid,validationDetails:U(a),validationErrors:a.validationMessage?[a.validationMessage]:[]}}function F(a){for(let e=0;e<a.elements.length;e++){let t=a.elements[e];if(!t.validity.valid)return t}return null}const M={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...M,customError:!0,valid:!1},m={isInvalid:!1,validationDetails:M,validationErrors:[]},Q=s.createContext({}),L="__formValidationState"+Date.now();function J(a){if(a[L]){let{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:n,commitValidation:r}=a[L];return{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:n,commitValidation:r}}return _(a)}function _(a){let{isInvalid:e,validationState:t,name:i,value:n,builtinValidation:r,validate:l,validationBehavior:u="aria"}=a;t&&(e||(e=t==="invalid"));let o=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,v=s.useMemo(()=>{if(!l||n==null)return null;let d=k(l,n);return D(d)},[l,n]);r!=null&&r.validationDetails.valid&&(r=void 0);let c=s.useContext(Q),f=s.useMemo(()=>i?Array.isArray(i)?i.flatMap(d=>I(c[d])):I(c[i]):[],[c,i]),[w,A]=s.useState(c),[S,b]=s.useState(!1);c!==w&&(A(c),b(!1));let p=s.useMemo(()=>D(S?[]:f),[S,f]),x=s.useRef(m),[E,y]=s.useState(m),$=s.useRef(m),O=()=>{if(!R)return;g(!1);let d=v||r||x.current;h(d,$.current)||($.current=d,y(d))},[R,g]=s.useState(!1);return s.useEffect(O),{realtimeValidation:o||p||v||r||m,displayValidation:u==="native"?o||p||E:o||p||v||r||E,updateValidation(d){u==="aria"&&!h(E,d)?y(d):x.current=d},resetValidation(){let d=m;h(d,$.current)||($.current=d,y(d)),u==="native"&&g(!1),b(!0)},commitValidation(){u==="native"&&g(!0),b(!0)}}}function I(a){return a?Array.isArray(a)?a:[a]:[]}function k(a,e){if(typeof a=="function"){let t=a(e);if(t&&typeof t!="boolean")return I(t)}return[]}function D(a){return a.length?{isInvalid:!0,validationErrors:a,validationDetails:C}:null}function h(a,e){return a===e?!0:!!a&&!!e&&a.isInvalid===e.isInvalid&&a.validationErrors.length===e.validationErrors.length&&a.validationErrors.every((t,i)=>t===e.validationErrors[i])&&Object.entries(a.validationDetails).every(([t,i])=>e.validationDetails[t]===i)}function K(...a){let e=new Set,t=!1,i={...M};for(let l of a){var n,r;for(let u of l.validationErrors)e.add(u);t||(t=l.isInvalid);for(let u in i)(n=i)[r=u]||(n[r]=l.validationDetails[u])}return i.valid=!t,{isInvalid:t,validationErrors:[...e],validationDetails:i}}export{G as $,H as a,J as b,L as c,m as d,K as e};
