import{a as z}from"./chain-B0TSDKn2.js";import{c as H,d as I,e as U,f as m,g as E,h as x,i as q,j as B,k as G,l as J,m as Y}from"./useFocusRing-DlZ7W1lC.js";import{a as w}from"./useEffectEvent-sx_rQw4H.js";import{d as Q}from"./useFocusable-Cemdbc1Y.js";import{r as N,R}from"./index-ClcD9ViR.js";class X{get currentNode(){return this._currentNode}set currentNode(e){if(!I(this.root,e))throw new Error("Cannot set currentNode to a node that is not contained by the root node.");const r=[];let o=e,n=e;for(this._currentNode=e;o&&o!==this.root;)if(o.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const l=o,i=this._doc.createTreeWalker(l,this.whatToShow,{acceptNode:this._acceptNode});r.push(i),i.currentNode=n,this._currentSetFor.add(i),o=n=l.host}else o=o.parentNode;const a=this._doc.createTreeWalker(this.root,this.whatToShow,{acceptNode:this._acceptNode});r.push(a),a.currentNode=n,this._currentSetFor.add(a),this._walkerStack=r}get doc(){return this._doc}firstChild(){let e=this.currentNode,r=this.nextNode();return I(e,r)?(r&&(this.currentNode=r),r):(this.currentNode=e,null)}lastChild(){let r=this._walkerStack[0].lastChild();return r&&(this.currentNode=r),r}nextNode(){const e=this._walkerStack[0].nextNode();if(e){if(e.shadowRoot){var r;let n;if(typeof this.filter=="function"?n=this.filter(e):!((r=this.filter)===null||r===void 0)&&r.acceptNode&&(n=this.filter.acceptNode(e)),n===NodeFilter.FILTER_ACCEPT)return this.currentNode=e,e;let a=this.nextNode();return a&&(this.currentNode=a),a}return e&&(this.currentNode=e),e}else if(this._walkerStack.length>1){this._walkerStack.shift();let o=this.nextNode();return o&&(this.currentNode=o),o}else return null}previousNode(){const e=this._walkerStack[0];if(e.currentNode===e.root){if(this._currentSetFor.has(e))if(this._currentSetFor.delete(e),this._walkerStack.length>1){this._walkerStack.shift();let n=this.previousNode();return n&&(this.currentNode=n),n}else return null;return null}const r=e.previousNode();if(r){if(r.shadowRoot){var o;let a;if(typeof this.filter=="function"?a=this.filter(r):!((o=this.filter)===null||o===void 0)&&o.acceptNode&&(a=this.filter.acceptNode(r)),a===NodeFilter.FILTER_ACCEPT)return r&&(this.currentNode=r),r;let l=this.lastChild();return l&&(this.currentNode=l),l}return r&&(this.currentNode=r),r}else if(this._walkerStack.length>1){this._walkerStack.shift();let n=this.previousNode();return n&&(this.currentNode=n),n}else return null}nextSibling(){return null}previousSibling(){return null}parentNode(){return null}constructor(e,r,o,n){this._walkerStack=[],this._currentSetFor=new Set,this._acceptNode=l=>{if(l.nodeType===Node.ELEMENT_NODE){const h=l.shadowRoot;if(h){const u=this._doc.createTreeWalker(h,this.whatToShow,{acceptNode:this._acceptNode});return this._walkerStack.unshift(u),NodeFilter.FILTER_ACCEPT}else{var i;if(typeof this.filter=="function")return this.filter(l);if(!((i=this.filter)===null||i===void 0)&&i.acceptNode)return this.filter.acceptNode(l);if(this.filter===null)return NodeFilter.FILTER_ACCEPT}}return NodeFilter.FILTER_SKIP},this._doc=e,this.root=r,this.filter=n??null,this.whatToShow=o??NodeFilter.SHOW_ALL,this._currentNode=r,this._walkerStack.unshift(e.createTreeWalker(r,o,this._acceptNode));const a=r.shadowRoot;if(a){const l=this._doc.createTreeWalker(a,this.whatToShow,{acceptNode:this._acceptNode});this._walkerStack.unshift(l)}}}function Z(t,e,r,o){return H()?new X(t,e,r,o):t.createTreeWalker(e,r,o)}function fe(t,e){let{id:r,"aria-label":o,"aria-labelledby":n}=t;return r=z(r),n&&o?n=[...new Set([r,...n.trim().split(/\s+/)])].join(" "):n&&(n=n.trim().split(/\s+/).join(" ")),!o&&!n&&e&&(o=e),{id:r,"aria-label":o,"aria-labelledby":n}}function ee(t){const e=U(t);if(!(t instanceof e.HTMLElement)&&!(t instanceof e.SVGElement))return!1;let{display:r,visibility:o}=t.style,n=r!=="none"&&o!=="hidden"&&o!=="collapse";if(n){const{getComputedStyle:a}=t.ownerDocument.defaultView;let{display:l,visibility:i}=a(t);n=l!=="none"&&i!=="hidden"&&i!=="collapse"}return n}function te(t,e){return!t.hasAttribute("hidden")&&!t.hasAttribute("data-react-aria-prevent-focus")&&(t.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?t.hasAttribute("open"):!0)}function O(t,e){return t.nodeName!=="#comment"&&ee(t)&&te(t,e)&&(!t.parentElement||O(t.parentElement,t))}const K=R.createContext(null),L="react-aria-focus-scope-restore";let f=null;function he(t){let{children:e,contain:r,restoreFocus:o,autoFocus:n}=t,a=N.useRef(null),l=N.useRef(null),i=N.useRef([]),{parentNode:h}=N.useContext(K)||{},u=N.useMemo(()=>new A({scopeRef:i}),[i]);w(()=>{let s=h||p.root;if(p.getTreeNode(s.scopeRef)&&f&&!F(f,s.scopeRef)){let c=p.getTreeNode(f);c&&(s=c)}s.addChild(u),p.addNode(u)},[u,h]),w(()=>{let s=p.getTreeNode(i);s&&(s.contain=!!r)},[r]),w(()=>{var s;let c=(s=a.current)===null||s===void 0?void 0:s.nextSibling,b=[],_=C=>C.stopPropagation();for(;c&&c!==l.current;)b.push(c),c.addEventListener(L,_),c=c.nextSibling;return i.current=b,()=>{for(let C of b)C.removeEventListener(L,_)}},[e]),ie(i,o,r),ne(i,r),ae(i,o,r),oe(i,n),N.useEffect(()=>{const s=m(E(i.current?i.current[0]:void 0));let c=null;if($(s,i.current)){for(let b of p.traverse())b.scopeRef&&$(s,b.scopeRef.current)&&(c=b);c===p.getTreeNode(i)&&(f=c.scopeRef)}},[i]),w(()=>()=>{var s,c,b;let _=(b=(c=p.getTreeNode(i))===null||c===void 0||(s=c.parent)===null||s===void 0?void 0:s.scopeRef)!==null&&b!==void 0?b:null;(i===f||F(i,f))&&(!_||p.getTreeNode(_))&&(f=_),p.removeTreeNode(i)},[i]);let v=N.useMemo(()=>re(i),[]),d=N.useMemo(()=>({focusManager:v,parentNode:u}),[u,v]);return R.createElement(K.Provider,{value:d},R.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:a}),e,R.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:l}))}function re(t){return{focusNext(e={}){let r=t.current,{from:o,tabbable:n,wrap:a,accept:l}=e;var i;let h=o||m(E((i=r[0])!==null&&i!==void 0?i:void 0)),u=r[0].previousElementSibling,v=g(r),d=k(v,{tabbable:n,accept:l},r);d.currentNode=$(h,r)?h:u;let s=d.nextNode();return!s&&a&&(d.currentNode=u,s=d.nextNode()),s&&T(s,!0),s},focusPrevious(e={}){let r=t.current,{from:o,tabbable:n,wrap:a,accept:l}=e;var i;let h=o||m(E((i=r[0])!==null&&i!==void 0?i:void 0)),u=r[r.length-1].nextElementSibling,v=g(r),d=k(v,{tabbable:n,accept:l},r);d.currentNode=$(h,r)?h:u;let s=d.previousNode();return!s&&a&&(d.currentNode=u,s=d.previousNode()),s&&T(s,!0),s},focusFirst(e={}){let r=t.current,{tabbable:o,accept:n}=e,a=g(r),l=k(a,{tabbable:o,accept:n},r);l.currentNode=r[0].previousElementSibling;let i=l.nextNode();return i&&T(i,!0),i},focusLast(e={}){let r=t.current,{tabbable:o,accept:n}=e,a=g(r),l=k(a,{tabbable:o,accept:n},r);l.currentNode=r[r.length-1].nextElementSibling;let i=l.previousNode();return i&&T(i,!0),i}}}function g(t){return t[0].parentElement}function y(t){let e=p.getTreeNode(f);for(;e&&e.scopeRef!==t;){if(e.contain)return!1;e=e.parent}return!0}function ne(t,e){let r=N.useRef(void 0),o=N.useRef(void 0);w(()=>{let n=t.current;if(!e){o.current&&(cancelAnimationFrame(o.current),o.current=void 0);return}const a=E(n?n[0]:void 0);let l=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!y(t)||u.isComposing)return;let v=m(a),d=t.current;if(!d||!$(v,d))return;let s=g(d),c=k(s,{tabbable:!0},d);if(!v)return;c.currentNode=v;let b=u.shiftKey?c.previousNode():c.nextNode();b||(c.currentNode=u.shiftKey?d[d.length-1].nextElementSibling:d[0].previousElementSibling,b=u.shiftKey?c.previousNode():c.nextNode()),u.preventDefault(),b&&T(b,!0)},i=u=>{(!f||F(f,t))&&$(x(u),t.current)?(f=t,r.current=x(u)):y(t)&&!S(x(u),t)?r.current?r.current.focus():f&&f.current&&M(f.current):y(t)&&(r.current=x(u))},h=u=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{let v=Y(),d=(v==="virtual"||v===null)&&q()&&B(),s=m(a);if(!d&&s&&y(t)&&!S(s,t)){f=t;let b=x(u);if(b&&b.isConnected){var c;r.current=b,(c=r.current)===null||c===void 0||c.focus()}else f.current&&M(f.current)}})};return a.addEventListener("keydown",l,!1),a.addEventListener("focusin",i,!1),n==null||n.forEach(u=>u.addEventListener("focusin",i,!1)),n==null||n.forEach(u=>u.addEventListener("focusout",h,!1)),()=>{a.removeEventListener("keydown",l,!1),a.removeEventListener("focusin",i,!1),n==null||n.forEach(u=>u.removeEventListener("focusin",i,!1)),n==null||n.forEach(u=>u.removeEventListener("focusout",h,!1))}},[t,e]),w(()=>()=>{o.current&&cancelAnimationFrame(o.current)},[o])}function V(t){return S(t)}function $(t,e){return!t||!e?!1:e.some(r=>r.contains(t))}function S(t,e=null){if(t instanceof Element&&t.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of p.traverse(p.getTreeNode(e)))if(r&&$(t,r.current))return!0;return!1}function ve(t){return S(t,f)}function F(t,e){var r;let o=(r=p.getTreeNode(e))===null||r===void 0?void 0:r.parent;for(;o;){if(o.scopeRef===t)return!0;o=o.parent}return!1}function T(t,e=!1){if(t!=null&&!e)try{Q(t)}catch{}else if(t!=null)try{t.focus()}catch{}}function j(t,e=!0){let r=t[0].previousElementSibling,o=g(t),n=k(o,{tabbable:e},t);n.currentNode=r;let a=n.nextNode();return e&&!a&&(o=g(t),n=k(o,{tabbable:!1},t),n.currentNode=r,a=n.nextNode()),a}function M(t,e=!0){T(j(t,e))}function oe(t,e){const r=R.useRef(e);N.useEffect(()=>{if(r.current){f=t;const o=E(t.current?t.current[0]:void 0);!$(m(o),f.current)&&t.current&&M(t.current)}r.current=!1},[t])}function ie(t,e,r){w(()=>{if(e||r)return;let o=t.current;const n=E(o?o[0]:void 0);let a=l=>{let i=x(l);$(i,t.current)?f=t:V(i)||(f=null)};return n.addEventListener("focusin",a,!1),o==null||o.forEach(l=>l.addEventListener("focusin",a,!1)),()=>{n.removeEventListener("focusin",a,!1),o==null||o.forEach(l=>l.removeEventListener("focusin",a,!1))}},[t,e,r])}function P(t){let e=p.getTreeNode(f);for(;e&&e.scopeRef!==t;){if(e.nodeToRestore)return!1;e=e.parent}return(e==null?void 0:e.scopeRef)===t}function ae(t,e,r){const o=N.useRef(typeof document<"u"?m(E(t.current?t.current[0]:void 0)):null);w(()=>{let n=t.current;const a=E(n?n[0]:void 0);if(!e||r)return;let l=()=>{(!f||F(f,t))&&$(m(a),t.current)&&(f=t)};return a.addEventListener("focusin",l,!1),n==null||n.forEach(i=>i.addEventListener("focusin",l,!1)),()=>{a.removeEventListener("focusin",l,!1),n==null||n.forEach(i=>i.removeEventListener("focusin",l,!1))}},[t,r]),w(()=>{const n=E(t.current?t.current[0]:void 0);if(!e)return;let a=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!y(t)||l.isComposing)return;let i=n.activeElement;if(!S(i,t)||!P(t))return;let h=p.getTreeNode(t);if(!h)return;let u=h.nodeToRestore,v=k(n.body,{tabbable:!0});v.currentNode=i;let d=l.shiftKey?v.previousNode():v.nextNode();if((!u||!u.isConnected||u===n.body)&&(u=void 0,h.nodeToRestore=void 0),(!d||!S(d,t))&&u){v.currentNode=u;do d=l.shiftKey?v.previousNode():v.nextNode();while(S(d,t));l.preventDefault(),l.stopPropagation(),d?T(d,!0):V(u)?T(u,!0):i.blur()}};return r||n.addEventListener("keydown",a,!0),()=>{r||n.removeEventListener("keydown",a,!0)}},[t,e,r]),w(()=>{const n=E(t.current?t.current[0]:void 0);if(!e)return;let a=p.getTreeNode(t);if(a){var l;return a.nodeToRestore=(l=o.current)!==null&&l!==void 0?l:void 0,()=>{let i=p.getTreeNode(t);if(!i)return;let h=i.nodeToRestore,u=m(n);if(e&&h&&(u&&S(u,t)||u===n.body&&P(t))){let v=p.clone();requestAnimationFrame(()=>{if(n.activeElement===n.body){let d=v.getTreeNode(t);for(;d;){if(d.nodeToRestore&&d.nodeToRestore.isConnected){W(d.nodeToRestore);return}d=d.parent}for(d=v.getTreeNode(t);d;){if(d.scopeRef&&d.scopeRef.current&&p.getTreeNode(d.scopeRef)){let s=j(d.scopeRef.current,!0);W(s);return}d=d.parent}}})}}}},[t,e])}function W(t){t.dispatchEvent(new CustomEvent(L,{bubbles:!0,cancelable:!0}))&&T(t)}function k(t,e,r){let o=e!=null&&e.tabbable?G:J,n=(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE?t:null,a=E(n),l=Z(a,t||a,NodeFilter.SHOW_ELEMENT,{acceptNode(i){var h;return!(e==null||(h=e.from)===null||h===void 0)&&h.contains(i)?NodeFilter.FILTER_REJECT:o(i)&&O(i)&&(!r||$(i,r))&&(!(e!=null&&e.accept)||e.accept(i))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e!=null&&e.from&&(l.currentNode=e.from),l}class D{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,r,o){let n=this.fastMap.get(r??null);if(!n)return;let a=new A({scopeRef:e});n.addChild(a),a.parent=n,this.fastMap.set(e,a),o&&(a.nodeToRestore=o)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let r=this.fastMap.get(e);if(!r)return;let o=r.parent;for(let a of this.traverse())a!==r&&r.nodeToRestore&&a.nodeToRestore&&r.scopeRef&&r.scopeRef.current&&$(a.nodeToRestore,r.scopeRef.current)&&(a.nodeToRestore=r.nodeToRestore);let n=r.children;o&&(o.removeChild(r),n.size>0&&n.forEach(a=>o&&o.addChild(a))),this.fastMap.delete(r.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let r of e.children)yield*this.traverse(r)}clone(){var e;let r=new D;var o;for(let n of this.traverse())r.addTreeNode(n.scopeRef,(o=(e=n.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&o!==void 0?o:null,n.nodeToRestore);return r}constructor(){this.fastMap=new Map,this.root=new A({scopeRef:null}),this.fastMap.set(null,this.root)}}class A{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let p=new D;export{fe as $,he as a,k as b,ve as c};
