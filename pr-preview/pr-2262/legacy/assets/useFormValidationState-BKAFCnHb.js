import{a as V,$ as B}from"./useEffectEvent-BaECT7_f.js";import{r as s}from"./index-v7USjxUg.js";import{g as T}from"./useFocusRing-CP9UJNUw.js";function G(a,e,t){let i=s.useRef(e),l=V(()=>{t&&t(i.current)});s.useEffect(()=>{var n;let r=a==null||(n=a.current)===null||n===void 0?void 0:n.form;return r==null||r.addEventListener("reset",l),()=>{r==null||r.removeEventListener("reset",l)}},[a,l])}function H(a,e,t){let{validationBehavior:i,focus:l}=a;B(()=>{if(i==="native"&&(t!=null&&t.current)&&!t.current.disabled){let d=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";t.current.setCustomValidity(d),t.current.hasAttribute("title")||(t.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(j(t.current))}});let n=V(()=>{e.resetValidation()}),r=V(d=>{var u;e.displayValidation.isInvalid||e.commitValidation();let c=t==null||(u=t.current)===null||u===void 0?void 0:u.form;if(!d.defaultPrevented&&t&&c&&F(c)===t.current){var v;l?l():(v=t.current)===null||v===void 0||v.focus(),T("keyboard")}d.preventDefault()}),f=V(()=>{e.commitValidation()});s.useEffect(()=>{let d=t==null?void 0:t.current;if(!d)return;let u=d.form;return d.addEventListener("invalid",r),d.addEventListener("change",f),u==null||u.addEventListener("reset",n),()=>{d.removeEventListener("invalid",r),d.removeEventListener("change",f),u==null||u.removeEventListener("reset",n)}},[t,r,f,n,i])}function U(a){let e=a.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function j(a){return{isInvalid:!a.validity.valid,validationDetails:U(a),validationErrors:a.validationMessage?[a.validationMessage]:[]}}function F(a){for(let e=0;e<a.elements.length;e++){let t=a.elements[e];if(!t.validity.valid)return t}return null}const M={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...M,customError:!0,valid:!1},m={isInvalid:!1,validationDetails:M,validationErrors:[]},Q=s.createContext({}),L="__formValidationState"+Date.now();function J(a){if(a[L]){let{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:l,commitValidation:n}=a[L];return{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:l,commitValidation:n}}return _(a)}function _(a){let{isInvalid:e,validationState:t,name:i,value:l,builtinValidation:n,validate:r,validationBehavior:f="aria"}=a;t&&(e||(e=t==="invalid"));let d=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,u=s.useMemo(()=>{if(!r||l==null)return null;let o=k(r,l);return D(o)},[r,l]);n!=null&&n.validationDetails.valid&&(n=void 0);let c=s.useContext(Q),v=s.useMemo(()=>i?Array.isArray(i)?i.flatMap(o=>I(c[o])):I(c[i]):[],[c,i]),[w,A]=s.useState(c),[S,b]=s.useState(!1);c!==w&&(A(c),b(!1));let p=s.useMemo(()=>D(S?[]:v),[S,v]),x=s.useRef(m),[E,y]=s.useState(m),$=s.useRef(m),O=()=>{if(!R)return;g(!1);let o=u||n||x.current;h(o,$.current)||($.current=o,y(o))},[R,g]=s.useState(!1);return s.useEffect(O),{realtimeValidation:d||p||u||n||m,displayValidation:f==="native"?d||p||E:d||p||u||n||E,updateValidation(o){f==="aria"&&!h(E,o)?y(o):x.current=o},resetValidation(){let o=m;h(o,$.current)||($.current=o,y(o)),f==="native"&&g(!1),b(!0)},commitValidation(){f==="native"&&g(!0),b(!0)}}}function I(a){return a?Array.isArray(a)?a:[a]:[]}function k(a,e){if(typeof a=="function"){let t=a(e);if(t&&typeof t!="boolean")return I(t)}return[]}function D(a){return a.length?{isInvalid:!0,validationErrors:a,validationDetails:C}:null}function h(a,e){return a===e?!0:!!a&&!!e&&a.isInvalid===e.isInvalid&&a.validationErrors.length===e.validationErrors.length&&a.validationErrors.every((t,i)=>t===e.validationErrors[i])&&Object.entries(a.validationDetails).every(([t,i])=>e.validationDetails[t]===i)}function K(...a){let e=new Set,t=!1,i={...M};for(let r of a){var l,n;for(let f of r.validationErrors)e.add(f);t||(t=r.isInvalid);for(let f in i)(l=i)[n=f]||(l[n]=r.validationDetails[f])}return i.valid=!t,{isInvalid:t,validationErrors:[...e],validationDetails:i}}export{G as $,J as a,H as b,L as c,m as d,K as e};
