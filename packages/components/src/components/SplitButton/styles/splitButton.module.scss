/* (c) Copyright Frontify Ltd., all rights reserved. */

@use '../../../utilities/focusStyle.module.scss';

@mixin content-button-style($bg-base, $bg-hover, $bg-pressed, $text-color, $icon-color, $text-hover: null) {
    background-color: var(--#{$bg-base});
    color: var(--#{$text-color});

    &:hover {
        background-color: var(--#{$bg-hover});
        @if $text-hover {
            color: var(--#{$text-hover});
        }
    }

    &:active {
        background-color: var(--#{$bg-pressed});
        @if $text-hover {
            color: var(--#{$text-hover});
        }
    }

    [class*="Icon"] {
        color: var(--#{$icon-color});
    }
}

@mixin action-button-style($bg-base, $bg-hover, $bg-pressed, $text-color, $icon-color) {
    .action > button {
        background-color: var(--#{$bg-base});
        color: var(--#{$text-color});

        &:hover {
            background-color: var(--#{$bg-hover});
        }

        &:active {
            background-color: var(--#{$bg-pressed});
        }

        svg {
            color: var(--#{$icon-color});
        }
    }
}

.root {
    display: inline-flex;
    align-items: stretch;
    position: relative;
    box-sizing: border-box;
    font-family: var(--typography-font-family-primary);
    font-weight: 500;
    white-space: nowrap;
    transition: background-color 250ms, color 250ms;

    &[data-size="small"] {
        height: 1.5rem;
        font-size: var(--typography-font-size-small);
        line-height: var(--typography-line-height-tight);

        .content {
            padding-inline: 0.75rem;
            gap: 0.375rem;
        }

        .action > button {
            min-width: 1.5rem;
        }
    }

    &[data-size="medium"] {
        height: 2.25rem;
        font-size: var(--typography-font-size-medium);
        line-height: var(--typography-line-height-medium);

        .content {
            padding-inline: 1rem;
            gap: 0.375rem;
        }
    }

    &[data-size="large"] {
        height: 3rem;
        font-size: var(--typography-font-size-large);
        line-height: var(--typography-line-height-wide);

        .content {
            padding-inline: 1.5rem;
            gap: 0.5rem;
        }

        .action > button {
            min-width: 3rem;
        }
    }

    border-radius: var(--border-radius-medium);

    &[data-disabled="true"] {
        .content {
            background-color: var(--color-container-disabled-default);
            color: var(--color-container-disabled-on-disabled-container);
            cursor: not-allowed;
            pointer-events: none;
            border-inline-end: var(--border-width-default) solid var(--color-line-subtle);

            [class*="Icon"] {
                color: var(--color-container-disabled-on-disabled-container);
            }
        }

        .action > button {
            background-color: var(--color-container-disabled-default);
            color: var(--color-container-disabled-on-disabled-container);
            cursor: not-allowed;
            pointer-events: none;

            svg {
                color: var(--color-container-disabled-on-disabled-container);
            }
        }
    }

    // Default variant (only variant)
    &[data-emphasis="default"]:not([data-disabled="true"]) {
        .content {
            @include content-button-style(
                color-container-secondary-default,
                color-container-secondary-hover,
                color-container-secondary-active,
                color-primary-default,
                color-primary-default
            );
        }

        @include action-button-style(
            color-container-secondary-default,
            color-container-secondary-hover,
            color-container-secondary-active,
            color-primary-default,
            color-primary-default
        );
    }

    &[data-emphasis="weak"]:not([data-disabled="true"]) {
        .content {
            @include content-button-style(
                transparent,
                color-container-secondary-hover,
                color-container-secondary-active,
                color-primary-default,
                color-primary-default
            );
        }

        @include action-button-style(
            transparent,
            color-container-secondary-hover,
            color-container-secondary-active,
            color-primary-default,
            color-primary-default
        );
    }

    &[data-emphasis="strong"]:not([data-disabled="true"]) {
        .content {
            @include content-button-style(
                color-primary-default,
                color-primary-hover,
                color-primary-active,
                color-primary-on-primary,
                color-primary-on-primary,
                color-primary-on-primary
            );
        }

        @include action-button-style(
            color-primary-default,
            color-primary-hover,
            color-primary-active,
            color-primary-on-primary,
            color-primary-on-primary
        );
    }

    // Remove divider for weak emphasis
    &[data-emphasis="weak"]:not([data-disabled="true"]) {
        .content {
            border-inline-end: none;
        }
    }
}

.content {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font: inherit;
    box-sizing: border-box;
    transition: background-color 250ms, color 250ms;
    white-space: nowrap;
    border-start-start-radius: var(--border-radius-medium);
    border-end-start-radius: var(--border-radius-medium);
    border-start-end-radius: 0;
    border-end-end-radius: 0;
    border: none;
    border-inline-end: var(--border-width-default) solid var(--color-line-subtle);
    position: relative;

    & {
        @include focusStyle.focus-outline;
    }

    &:focus-visible {
        z-index: 1;
    }
}

.action {
    display: flex;
    align-items: stretch;
    flex-shrink: 0;

    > button {
        height: 100%;
        min-width: 2.25rem;
        border-start-end-radius: var(--border-radius-medium);
        border-end-end-radius: var(--border-radius-medium);
        border-start-start-radius: 0;
        border-end-start-radius: 0;
    }

    &[data-rotate-icon="true"] > button {
        svg {
            transition: transform 150ms ease-out;
        }

        &[data-state="open"] svg {
            transform: rotate(180deg);
        }
    }
}

.actionButton {
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font: inherit;
    box-sizing: border-box;
    border: none;
    transition: background-color 250ms, color 250ms;
    white-space: nowrap;
    position: relative;

    & {
        @include focusStyle.focus-outline;
    }

    &:focus-visible {
        z-index: 1;
    }
}

// Individual Content disabled state (higher specificity to override emphasis styles)
.root .content:disabled {
    background-color: var(--color-container-disabled-default) !important;
    color: var(--color-container-disabled-on-disabled-container) !important;
    cursor: not-allowed;
    pointer-events: none;
    border-inline-end: var(--border-width-default) solid var(--color-line-subtle);

    &:hover {
        background-color: var(--color-container-disabled-default) !important;
    }

    &:active {
        background-color: var(--color-container-disabled-default) !important;
    }

    [class*="Icon"] {
        color: var(--color-container-disabled-on-disabled-container) !important;
    }
}

// Individual ActionButton disabled state (higher specificity to override emphasis styles)
.root .action > .actionButton:disabled {
    background-color: var(--color-container-disabled-default) !important;
    color: var(--color-container-disabled-on-disabled-container) !important;
    cursor: not-allowed;
    pointer-events: none;

    &:hover {
        background-color: var(--color-container-disabled-default) !important;
    }

    &:active {
        background-color: var(--color-container-disabled-default) !important;
    }

    svg {
        color: var(--color-container-disabled-on-disabled-container) !important;
    }
}

// Apply active colors for each emphasis when dropdown is open
.root[data-emphasis="default"]:not([data-disabled="true"]) {
    .action > button[data-state="open"] {
        background-color: var(--color-container-secondary-active) !important;
    }
}

.root[data-emphasis="weak"]:not([data-disabled="true"]) {
    .action > button[data-state="open"] {
        background-color: var(--color-container-secondary-active) !important;
    }
}

.root[data-emphasis="strong"]:not([data-disabled="true"]) {
    .action > button[data-state="open"] {
        background-color: var(--color-primary-active) !important;
    }
}
